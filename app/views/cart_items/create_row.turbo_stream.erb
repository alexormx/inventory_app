<%# Inserta o reemplaza fila tras agregar producto desde la pÃ¡gina del carrito %>
<% qty = session[:cart][@product.id.to_s] %>
<% if @new_row %>
  <%= turbo_stream.append 'cart-items' do %>
    <%= render 'carts/cart_item', product: @product, quantity: qty, cart: @cart %>
  <% end %>
<% else %>
  <%= turbo_stream.replace "cart_item_#{@product.id}" do %>
    <%= render 'carts/cart_item', product: @product, quantity: qty, cart: @cart %>
  <% end %>
<% end %>

<%= turbo_stream.replace 'cart-total' do %>
  <%= number_to_currency(@cart.total) %>
<% end %>

<%= turbo_stream.replace 'cart-count' do %>
  <span id="cart-count" class="badge bg-danger rounded-pill position-absolute top-0 start-100 translate-middle"><%= @cart.item_count %></span>
<% end %>

<%= turbo_stream.replace 'cart-item-count' do %>
  <span id="cart-item-count"><%= @cart.item_count %></span>
<% end %>
<%= turbo_stream.replace 'summary-subtotal' do %>
  <strong id="summary-subtotal"><%= number_to_currency(@cart.subtotal) %></strong>
<% end %>
<%= turbo_stream.replace 'summary-tax' do %>
  <%= @cart.tax_enabled? ? number_to_currency(@cart.tax_amount) : '-' %>
<% end %>
<%= turbo_stream.replace 'summary-shipping' do %>
  <%= number_to_currency(@cart.shipping_cost) %>
<% end %>
<%= turbo_stream.replace 'summary-grand-total' do %>
  <strong id="summary-grand-total"><%= number_to_currency(@cart.grand_total) %></strong>
<% end %>

<%# Mensaje flash %>
<% if flash.now[:notice] %>
  <%= turbo_stream.append 'flash-stack' do %>
    <div class="alert alert-success flash-message" role="alert" data-timeout="2400"><%= flash.now[:notice] %></div>
  <% end %>
<% end %>