<div class="container py-4 product-show" data-controller="productMeta">
  <div class="row gy-4">
    <div class="col-lg-6">
      <% if @product.product_images.attached? %>
        <%= render 'products/gallery', product: @product %>
      <% else %>
        <%= image_tag 'placeholder.png', class: 'w-100 rounded shadow-sm', alt: 'Imagen no disponible' %>
      <% end %>
    </div>
    <div class="col-lg-6 col-xl-5 offset-xl-1">
      <%= render 'products/summary_panel', product: @product %>
    </div>
  </div>

  <div class="row mt-5 g-4">
    <div class="col-lg-8">
      <!-- Información básica siempre visible -->
      <div class="card border-0 shadow-sm mb-4" id="info-basica">
        <div class="card-body">
          <h2 class="h5 fw-semibold mb-3"><i class="fas fa-info-circle text-primary me-2"></i>Información del Producto</h2>
          <div class="row g-3">
            <div class="col-sm-6">
              <div class="d-flex align-items-center">
                <i class="fas fa-tag text-muted me-2"></i>
                <div>
                  <small class="text-muted d-block">Categoría</small>
                  <strong><%= @product.category %></strong>
                </div>
              </div>
            </div>
            <div class="col-sm-6">
              <div class="d-flex align-items-center">
                <i class="fas fa-copyright text-muted me-2"></i>
                <div>
                  <small class="text-muted d-block">Marca</small>
                  <strong><%= @product.brand %></strong>
                </div>
              </div>
            </div>
            <div class="col-sm-6">
              <div class="d-flex align-items-center">
                <i class="fas fa-barcode text-muted me-2"></i>
                <div>
                  <small class="text-muted d-block">SKU</small>
                  <strong><%= @product.product_sku %></strong>
                </div>
              </div>
            </div>
            <% if @product.barcode.present? %>
            <div class="col-sm-6">
              <div class="d-flex align-items-center">
                <i class="fas fa-qrcode text-muted me-2"></i>
                <div>
                  <small class="text-muted d-block">Código de Barras</small>
                  <strong><%= @product.barcode %></strong>
                </div>
              </div>
            </div>
            <% end %>
          </div>
        </div>
      </div>

      <div class="card border-0 shadow-sm" id="descripcion" data-product-description>
        <div class="card-body">
          <h2 class="h5 fw-semibold mb-3"><i class="fas fa-align-left text-primary me-2"></i>Descripción</h2>
          <% if @product.description.present? %>
            <p class="text-muted mb-0" style="white-space: pre-line;"><%= @product.description %></p>
          <% else %>
            <div class="alert alert-light border mb-0 text-center py-4">
              <i class="fas fa-info-circle text-muted fa-2x mb-2"></i>
              <p class="text-muted mb-0">Este producto aún no tiene una descripción detallada.</p>
              <p class="text-muted small mb-0">Estamos trabajando para agregarlo pronto.</p>
            </div>
          <% end %>
        </div>
      </div>

      <div class="card border-0 shadow-sm mt-4" id="detalles">
        <div class="card-body">
          <h2 class="h5 fw-semibold mb-3"><i class="fas fa-list-alt text-primary me-2"></i>Detalles del Producto</h2>
          <% if @product.custom_attributes.present? && @product.parsed_custom_attributes.any? %>
            <div class="row row-cols-1 row-cols-sm-2 g-3 small">
              <% @product.parsed_custom_attributes.each do |key, value| %>
                <div class="col d-flex">
                  <div class="w-50 text-muted text-capitalize fw-semibold"><%= key.to_s.humanize %></div>
                  <div class="flex-grow-1"><%= value %></div>
                </div>
              <% end %>
            </div>
          <% else %>
            <div class="alert alert-light border mb-0 text-center py-3">
              <i class="fas fa-box-open text-muted fa-lg mb-2"></i>
              <p class="text-muted small mb-0">No hay atributos adicionales disponibles para este producto.</p>
            </div>
          <% end %>
        </div>
      </div>
    </div>
    <div class="col-lg-4 d-none d-lg-block"><!-- espacio lateral futuro (relacionados, reviews) --></div>
  </div>
</div>

<style>
.product-show .product-gallery .gallery-viewport{overflow:hidden;border-radius:.5rem}
.product-show .gallery-track{display:flex;transition:transform .45s cubic-bezier(.4,.1,.2,1)}
.product-show .gallery-slide{flex:0 0 100%;padding:2px}
.product-show .gallery-nav{position:absolute;top:50%;transform:translateY(-50%);background:#fff;border:0;border-radius:50%;width:36px;height:36px;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 6px rgba(0,0,0,.15);cursor:pointer;font-size:20px;color:#444}
.product-show .gallery-nav.prev{left:8px}.product-show .gallery-nav.next{right:8px}
.product-show .gallery-thumbs .thumbnail-image{width:72px;height:72px;object-fit:cover}
.product-summary{position:sticky;top:calc(var(--banner-height,0px) + var(--nav-height,60px) + 1rem)}
.product-summary .line-clamp{-webkit-line-clamp:3;-webkit-box-orient:vertical;display:-webkit-box;overflow:hidden}
@media (max-width: 991px){.product-summary{position:static}}
</style>
