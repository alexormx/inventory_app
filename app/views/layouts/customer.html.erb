<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <title><%= content_for?(:title) ? yield(:title) : "Pasatiempos a Escala" %></title>

  <meta name="description" content="<%= content_for?(:meta_description) ? yield(:meta_description) : 'Pasatiempos a Escala. Muy pronto podrÃ¡s ver productos disponibles para comprar en lÃ­nea.' %>">
  <meta name="author" content="Pasatiempos">
  <meta name="robots" content="index, follow">
  <meta name="language" content="es">
  
  <!-- Favicon -->
  <%= favicon_link_tag 'favicon.ico' %>
  <%= favicon_link_tag 'favicon.svg', type: 'image/svg+xml' %>
  <link rel="apple-touch-icon" href="/favicon.ico">

  <!-- Open Graph / Facebook -->
  <meta property="og:title" content="<%= content_for?(:title) ? yield(:title) : 'Pasatiempos' %>">
  <meta property="og:description" content="<%= content_for?(:meta_description) ? yield(:meta_description) : 'Muy pronto podrÃ¡s ver productos disponibles en Pasatiempos.' %>">
  <meta property="og:image" content="https://pasatiempos.com.mx/logo.png">
  <meta property="og:url" content="https://pasatiempos.com.mx">
  <meta property="og:type" content="website">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="<%= content_for?(:title) ? yield(:title) : 'Pasatiempos' %>">
  <meta name="twitter:description" content="<%= content_for?(:meta_description) ? yield(:meta_description) : 'Muy pronto podrÃ¡s ver productos disponibles en Pasatiempos.' %>">
  <meta name="twitter:image" content="https://pasatiempos.com.mx/logo.png">


  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>

  <%# Preload LCP (home y producto show) usando helpers %>
  <%= lcp_preload_home_image if controller_path == 'home' && action_name == 'index' %>
  <%= lcp_preload_product_image(@product) if controller_path == 'products' && action_name == 'show' %>

  <!-- Font Awesome diferido para evitar bloqueo de render -->
  <script>
    (function() {
      var href = "https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css";
      function loadFA(){
        if (document.documentElement.classList.contains('fa-loaded')) return;
        var l = document.createElement('link');
        l.rel = 'stylesheet';
        l.href = href;
        l.crossOrigin = 'anonymous';
        l.referrerPolicy = 'no-referrer';
        document.head.appendChild(l);
        document.documentElement.classList.add('fa-loaded');
      }
      if ('requestIdleCallback' in window) {
        requestIdleCallback(loadFA, {timeout: 2000});
      } else {
        window.addEventListener('load', loadFA);
      }
    })();
  </script>
  <noscript>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
  </noscript>
  
  <%= stylesheet_link_tag "application", media: "all", "data-turbo-track": "reload" %>
  <%= javascript_importmap_tags %>
</head>


<body>
  <!-- Incluir el partial del banner (movido dentro de body) -->
  <%= render 'layouts/cookies_banner'%>
  <div id="construction-banner" class="alert alert-warning text-center mb-0 rounded-0 construction-banner" role="alert" style="padding: 0.3rem 1rem; font-size: 0.9rem; position:fixed; top:0; left:0; right:0; z-index:1200;">
    ðŸš§ Bienvenido a <strong>Pasatiempos a Escala</strong> â€“ Sitio en construcciÃ³n. Muy pronto podrÃ¡s ver nuestros autos coleccionables.
  </div>

  <!-- âœ… NAVBAR -->
  <header id="site-header" data-turbo-permanent>
    <%= render 'customers/partials/navbar' %>
  </header>

  <!-- âœ… Main Content con transiciÃ³n (sin skeleton) -->
  <main class="container mt-4 page-main" data-page-transition>
    <%= render 'layouts/flash' %>
    <%= yield %>
  </main>
  
  <!-- âœ… Floating WhatsApp Button -->
  <%= render 'layouts/floating_whatsapp' %>

  <!-- âœ… Footer (persistente) -->
  <footer id="site-footer" data-turbo-permanent>
    <%= render 'customers/partials/footer' %>
  </footer>

  <script>
    (function(){
      if(window.__layoutSpacingInit) return; // evitar listeners duplicados por Turbo
      window.__layoutSpacingInit = true;
      function recalcLayout(){
        const banner = document.getElementById('construction-banner');
        const nav = document.querySelector('.site-navbar');
        if(!banner || !nav) return;
        const bannerH = banner.offsetHeight;
        document.documentElement.style.setProperty('--banner-height', bannerH + 'px');
        requestAnimationFrame(()=>{
          const navH = nav.offsetHeight;
          document.documentElement.style.setProperty('--nav-height', navH + 'px');
          document.body.style.paddingTop = (bannerH + navH) + 'px';
        });
      }
      ['turbo:load','turbo:render'].forEach(ev=>document.addEventListener(ev,recalcLayout));
      window.addEventListener('resize', recalcLayout, {passive:true});
      recalcLayout();
    })();
  </script>

  <script>
  // TransiciÃ³n bÃ¡sica de desvanecido sin skeleton
  (function(){
    if(window.__pageTransitionsInit) return; window.__pageTransitionsInit = true;
    document.addEventListener('turbo:visit', () => {
      const main = document.querySelector('main.page-main');
      if(main){ main.classList.add('is-leaving'); }
    });
    document.addEventListener('turbo:before-render', (e)=>{
      const newMain = e.detail.newBody && e.detail.newBody.querySelector('main.page-main');
      if(newMain){ newMain.classList.add('will-enter'); }
    });
    function finalizeEnter(){
      const main = document.querySelector('main.page-main');
      if(!main) return;
      main.classList.remove('is-leaving');
      main.classList.add('is-entering');
      setTimeout(()=> main.classList.remove('is-entering','will-enter'), 200);
    }
    document.addEventListener('turbo:render', finalizeEnter);
    document.addEventListener('turbo:load', finalizeEnter);
  })();
  </script>

</body>
</html>
