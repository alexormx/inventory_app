<div class="d-flex justify-content-between align-items-center mb-3">
  <h1 class="h5 mb-0">Editar dirección de <%= @user.name %></h1>
  <%= link_to 'Regresar', admin_user_shipping_addresses_path(@user), class: 'btn btn-outline-secondary btn-sm' %>
</div>

<%= form_with model: [:admin, @user, @address], local: true do |f| %>
  <div class="card">
    <div class="card-body">
      <div class="row g-2">
        <div class="col-6">
          <%= f.label :label, 'Etiqueta' %>
          <%= f.text_field :label, class: 'form-control', placeholder: 'Casa / Oficina' %>
        </div>
        <div class="col-6">
          <%= f.label :full_name, 'Nombre' %>
          <%= f.text_field :full_name, class: 'form-control', required: true %>
        </div>
        <div class="col-12">
          <%= f.label :line1, 'Dirección (línea 1)' %>
          <%= f.text_field :line1, class: 'form-control', required: true %>
        </div>
        <div class="col-12">
          <%= f.label :line2, 'Dirección (línea 2)' %>
          <%= f.text_field :line2, class: 'form-control' %>
        </div>
        <div class="col-4">
          <%= f.label :postal_code, 'CP' %>
          <%= f.text_field :postal_code, class: 'form-control', required: true, id: 'admin_edit_addr_cp', maxlength: 5 %>
        </div>
        <div class="col-8">
          <%= f.label :settlement, 'Colonia' %>
          <select class="form-select" id="admin_edit_addr_colonia" name="shipping_address[settlement]"></select>
        </div>
        <div class="col-6">
          <%= f.label :municipality, 'Municipio' %>
          <%= f.text_field :municipality, class: 'form-control', id: 'admin_edit_addr_municipio', readonly: true %>
        </div>
        <div class="col-6">
          <%= f.label :state, 'Estado' %>
          <%= f.text_field :state, class: 'form-control', id: 'admin_edit_addr_estado', readonly: true %>
        </div>
        <div class="col-6">
          <%= f.label :city, 'Ciudad (manual)' %>
          <%= f.text_field :city, class: 'form-control', required: true %>
        </div>
        <div class="col-6">
          <%= f.label :country, 'País' %>
          <%= f.text_field :country, class: 'form-control', value: 'MX', required: true %>
        </div>
        <div class="col-12 form-check mt-1">
          <%= f.check_box :default, class: 'form-check-input', id: 'addr_default' %>
          <%= f.label :default, 'Establecer como predeterminada', class: 'form-check-label' %>
        </div>
      </div>
    </div>
    <div class="card-footer d-flex justify-content-end gap-2">
      <%= link_to 'Cancelar', admin_user_shipping_addresses_path(@user), class: 'btn btn-outline-secondary' %>
      <%= f.submit 'Guardar', class: 'btn btn-primary' %>
    </div>
  </div>
<% end %>

<script type="module">
  import { setupAddressAutofill } from '/assets/custom/address_autofill.js';
  document.addEventListener('turbo:load', () => {
    setupAddressAutofill({
      cpInput: '#admin_edit_addr_cp',
      coloniaSelect: '#admin_edit_addr_colonia',
      municipioInput: '#admin_edit_addr_municipio',
      estadoInput: '#admin_edit_addr_estado'
    });
  });
</script>
