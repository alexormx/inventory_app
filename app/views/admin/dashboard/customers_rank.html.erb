<% rel ||= @rel %>
<% rows ||= @rows %>
<% period ||= @period %>
<% metric ||= @metric %>
<turbo-frame id="frame-cust-<%= period %>-<%= metric %>">
  <div class="table-responsive">
    <table class="table table-sm mb-0">
      <thead>
        <tr>
          <th>Rank</th>
          <th>Cliente</th>
          <% if metric == 'reserved' %>
            <th class="text-end">Unidades apartadas</th>
            <th class="text-end">Valor apartados</th>
          <% elsif metric == 'combined' %>
            <th class="text-end">Órdenes</th>
            <th class="text-end">Ingresos</th>
            <th class="text-end">Valor apartados</th>
            <th class="text-end">Total</th>
          <% else %>
            <th class="text-end">Órdenes</th>
            <th class="text-end">Ingresos</th>
          <% end %>
        </tr>
      </thead>
      <tbody>
        <% if rows.present? %>
          <% rows.each_with_index do |u, idx| %>
            <tr>
              <td class="text-muted">#<%= ((rel.current_page - 1) * rel.limit_value) + idx + 1 %></td>
              <td><%= link_to (u[:name] || u[:user_id]), edit_admin_user_path(u[:user_id]) %></td>
              <% if metric == 'reserved' %>
                <td class="text-end"><%= number_with_delimiter(u[:units_reserved]) %></td>
                <td class="text-end"><%= number_to_currency(u[:reserved_value]) %></td>
              <% elsif metric == 'combined' %>
                <td class="text-end"><%= number_with_delimiter(u[:orders_count]) %></td>
                <td class="text-end"><%= number_to_currency(u[:revenue]) %></td>
                <td class="text-end"><%= number_to_currency(u[:reserved_value]) %></td>
                <td class="text-end"><%= number_to_currency(u[:total]) %></td>
              <% else %>
                <td class="text-end"><%= number_with_delimiter(u[:orders_count]) %></td>
                <td class="text-end"><%= number_to_currency(u[:revenue]) %></td>
              <% end %>
            </tr>
          <% end %>
        <% else %>
          <% 3.times do %>
            <tr class="placeholder-row"><td colspan="7" class="placeholder-glow"><span class="placeholder col-12"></span></td></tr>
          <% end %>
        <% end %>
      </tbody>
    </table>
  </div>
  <div class="px-3 py-2 d-flex justify-content-between align-items-center">
    <div class="small text-muted"><%= page_entries_info rel if defined?(page_entries_info) && rel.respond_to?(:current_page) %></div>
    <nav aria-label="Paginación clientes">
      <ul class="pagination pagination-sm mb-0">
        <% prev_params = request.query_parameters.merge(page: rel.prev_page, period: period, metric: metric, per: rel.limit_value) %>
        <% next_params = request.query_parameters.merge(page: rel.next_page, period: period, metric: metric, per: rel.limit_value) %>
        <li class="page-item <%= 'disabled' unless rel.prev_page %>">
          <%= link_to 'Anterior', admin_dashboard_customers_rank_path(prev_params), data: { turbo_frame: "frame-cust-#{period}-#{metric}" }, class: 'page-link' %>
        </li>
        <li class="page-item <%= 'disabled' unless rel.next_page %>">
          <%= link_to 'Siguiente', admin_dashboard_customers_rank_path(next_params), data: { turbo_frame: "frame-cust-#{period}-#{metric}" }, class: 'page-link' %>
        </li>
      </ul>
    </nav>
  </div>
</turbo-frame>
