<%
  # Breadcrumb dinámico basado en controller/action
  controller_name_human = {
    'dashboard' => 'Dashboard',
    'products' => 'Productos',
    'purchase_orders' => 'Órdenes de Compra',
    'sale_orders' => 'Órdenes de Venta',
    'inventory' => 'Inventario',
    'inventory_adjustments' => 'Ajustes de Inventario',
    'users' => 'Usuarios',
    'suppliers' => 'Proveedores',
    'customers' => 'Clientes',
    'categories' => 'Categorías',
    'system_variables' => 'Variables del Sistema',
    'site_settings' => 'Configuración',
    'inventory_audits' => 'Auditoría Inventario',
    'sale_orders_audits' => 'Auditoría Ventas',
    'inventory_events' => 'Eventos Inventario',
    'preorders' => 'Pre-órdenes'
  }[controller.controller_name] || controller.controller_name.titleize

  action_name_human = {
    'index' => nil,
    'show' => 'Detalle',
    'new' => 'Nuevo',
    'edit' => 'Editar',
    'create' => 'Nuevo',
    'update' => 'Editar'
  }[action_name] || action_name.titleize
%>
<nav class="navbar navbar-expand-lg admin-navbar">
  <div class="container-fluid">

    <div class="d-flex align-items-center gap-2">
      <!-- Toggle sidebar (mobile only) -->
      <button id="sidebarToggle" class="sidebar-toggle-btn d-inline d-lg-none js-sidebar-toggle" aria-label="Toggle sidebar" data-sidebar-toggle>
        <i class="fa-solid fa-bars"></i>
      </button>
      
      <!-- Breadcrumb -->
      <nav aria-label="breadcrumb" class="admin-breadcrumb d-none d-md-block">
        <ol class="breadcrumb mb-0">
          <li class="breadcrumb-item">
            <%= link_to admin_dashboard_path do %>
              <i class="fa-solid fa-house-chimney"></i>
            <% end %>
          </li>
          <% if controller.controller_name != 'dashboard' %>
            <li class="breadcrumb-item <%= action_name == 'index' ? 'active' : '' %>">
              <% index_path = send("admin_#{controller.controller_name}_path") rescue nil %>
              <% if action_name == 'index' || index_path.nil? %>
                <%= controller_name_human %>
              <% else %>
                <%= link_to controller_name_human, index_path %>
              <% end %>
            </li>
            <% if action_name_human.present? %>
              <li class="breadcrumb-item active"><%= action_name_human %></li>
            <% end %>
          <% end %>
        </ol>
      </nav>
      
      <!-- Mobile: Solo título de sección -->
      <span class="navbar-brand mb-0 h6 d-md-none"><%= controller_name_human %></span>
    </div>

    <!-- Navbar toggler for actions menu (mobile) -->
    <button class="navbar-toggler ms-auto d-lg-none" id="admin-hamburger" type="button" aria-controls="admin-navbar" aria-expanded="false" aria-label="Toggle navigation">
      <i class="fa-solid fa-ellipsis-vertical"></i>
    </button>

    <!-- Acciones -->
    <div class="collapse navbar-collapse justify-content-end" id="admin-navbar">
      <ul class="navbar-nav align-items-center gap-1">
        <!-- Ver tienda -->
        <li class="nav-item">
          <%= link_to root_path, class: "nav-link", title: "Ver tienda", target: "_blank" do %>
            <i class="fa-solid fa-store"></i>
            <span class="ms-2">Ver tienda</span>
          <% end %>
        </li>
        
        <% if current_user %>
          <% user_label = current_user.name.presence || current_user.email %>
          <% initials = user_label.to_s.split.map { |p| p[0] }.join.upcase[0,2] %>
          <!-- Usuario -->
          <li class="nav-item">
            <%= link_to edit_admin_user_path(current_user), class: "nav-link user-chip", title: "Mi perfil" do %>
              <span class="user-initials"><%= initials %></span>
            <% end %>
          </li>
        <% end %>
        
        <!-- Logout -->
        <li class="nav-item">
          <%= link_to destroy_user_session_path, data: { "turbo-method": :delete }, class: "nav-link nav-link-logout", title: "Cerrar sesión" do %>
            <i class="fa-solid fa-right-from-bracket"></i>
            <span class="ms-2">Cerrar sesión</span>
          <% end %>
        </li>
      </ul>
    </div>

  </div>
</nav>