<div class="container mt-3">
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><%= link_to 'Ubicaciones', admin_inventory_locations_path %></li>
      <% @inventory_location.ancestors.each do |ancestor| %>
        <li class="breadcrumb-item"><%= link_to ancestor.name, admin_inventory_location_path(ancestor) %></li>
      <% end %>
      <li class="breadcrumb-item active"><%= @inventory_location.name %></li>
    </ol>
  </nav>

  <div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
      <div>
        <span class="badge bg-<%= location_type_color(@inventory_location.location_type) %> me-2">
          <%= @inventory_location.type_name %>
        </span>
        <strong class="fs-5"><%= @inventory_location.name %></strong>
        <span class="text-muted ms-2">(<%= @inventory_location.code %>)</span>
      </div>
      <div class="btn-group">
        <%= link_to new_admin_inventory_location_path(parent_id: @inventory_location.id), class: 'btn btn-success' do %>
          <i class="fas fa-plus"></i> Agregar Sub-ubicación
        <% end %>
        <%= link_to edit_admin_inventory_location_path(@inventory_location), class: 'btn btn-primary' do %>
          <i class="fas fa-pencil-alt"></i> Editar
        <% end %>
      </div>
    </div>

    <div class="card-body">
      <div class="row">
        <div class="col-md-6">
          <h6 class="text-muted">Información General</h6>
          <table class="table table-sm">
            <tr>
              <th width="150">Código:</th>
              <td><code><%= @inventory_location.code %></code></td>
            </tr>
            <tr>
              <th>Tipo:</th>
              <td><%= @inventory_location.type_name %></td>
            </tr>
            <tr>
              <th>Estado:</th>
              <td>
                <% if @inventory_location.active? %>
                  <span class="badge bg-success">Activo</span>
                <% else %>
                  <span class="badge bg-danger">Inactivo</span>
                <% end %>
              </td>
            </tr>
            <tr>
              <th>Nivel de profundidad:</th>
              <td><%= @inventory_location.depth %></td>
            </tr>
            <tr>
              <th>Ruta completa:</th>
              <td><small><%= @inventory_location.full_path %></small></td>
            </tr>
            <% if @inventory_location.description.present? %>
              <tr>
                <th>Descripción:</th>
                <td><%= @inventory_location.description %></td>
              </tr>
            <% end %>
          </table>
        </div>

        <div class="col-md-6">
          <h6 class="text-muted">Estadísticas</h6>
          <table class="table table-sm">
            <tr>
              <th width="200">Sub-ubicaciones directas:</th>
              <td><%= @children.count %></td>
            </tr>
            <tr>
              <th>Total sub-ubicaciones:</th>
              <td><%= @inventory_location.descendants.count %></td>
            </tr>
            <tr>
              <th>Inventario en esta ubicación:</th>
              <td>
                <% inv_count = Inventory.where(inventory_location_id: @inventory_location.id).count %>
                <%= inv_count %>
                <% if inv_count > 0 %>
                  <%= link_to '(ver)', admin_inventory_path(inventory_location_id: @inventory_location.id), class: 'ms-1' %>
                <% end %>
              </td>
            </tr>
            <tr>
              <th>Inventario total (incluyendo sub-ubicaciones):</th>
              <td><%= @inventories_count %></td>
            </tr>
          </table>
        </div>
      </div>

      <% if @children.any? %>
        <hr>
        <h6 class="text-muted">Sub-ubicaciones (<%= @children.count %>)</h6>
        <table class="table table-striped table-hover">
          <thead>
            <tr>
              <th>Tipo</th>
              <th>Nombre</th>
              <th>Código</th>
              <th>Sub-ubicaciones</th>
              <th>Estado</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <% @children.each do |child| %>
              <tr>
                <td><span class="badge bg-<%= location_type_color(child.location_type) %>"><%= child.type_name %></span></td>
                <td><%= link_to child.name, admin_inventory_location_path(child) %></td>
                <td><code><%= child.code %></code></td>
                <td><%= child.children.count %></td>
                <td>
                  <% if child.active? %>
                    <span class="badge bg-success">Activo</span>
                  <% else %>
                    <span class="badge bg-danger">Inactivo</span>
                  <% end %>
                </td>
                <td class="text-end">
                  <%= link_to edit_admin_inventory_location_path(child), class: 'btn btn-sm btn-outline-primary' do %>
                    <i class="fas fa-pencil-alt"></i>
                  <% end %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      <% end %>
    </div>

    <div class="card-footer text-muted">
      Creado: <%= @inventory_location.created_at.strftime('%d/%m/%Y %H:%M') %> |
      Última actualización: <%= @inventory_location.updated_at.strftime('%d/%m/%Y %H:%M') %>
    </div>
  </div>

  <div class="mt-3">
    <%= link_to '← Volver a Ubicaciones', admin_inventory_locations_path, class: 'btn btn-outline-secondary' %>
  </div>
</div>
