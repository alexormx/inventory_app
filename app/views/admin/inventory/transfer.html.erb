<% content_for :title, "Transferir Inventario" %>

<div class="container-fluid mt-3" data-controller="inventory-transfer">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h3><i class="fas fa-exchange-alt"></i> Transferir Inventario entre Ubicaciones</h3>
      <p class="text-muted mb-0">
        Selecciona la ubicación origen y destino, luego marca las piezas que deseas mover.
      </p>
    </div>
    <div>
      <%= link_to admin_inventory_path, class: 'btn btn-outline-secondary' do %>
        <i class="fas fa-arrow-left"></i> Volver a Inventario
      <% end %>
    </div>
  </div>

  <div class="row">
    <!-- Panel Origen -->
    <div class="col-md-6">
      <div class="card h-100">
        <div class="card-header bg-primary text-white">
          <i class="fas fa-sign-out-alt"></i> Ubicación Origen
        </div>
        <div class="card-body">
          <div class="mb-3">
            <label class="form-label fw-bold">Seleccionar ubicación:</label>
            <select class="form-select"
                    data-inventory-transfer-target="sourceSelect"
                    data-action="change->inventory-transfer#loadSource">
              <option value="">-- Seleccionar ubicación origen --</option>
              <% @locations.each do |loc| %>
                <option value="<%= loc.id %>" data-url="<%= admin_inventory_location_items_path(location_id: loc.id) %>">
                  <%= loc.full_path %> (<%= loc.inventories.where(status: %i[available reserved]).count %> piezas)
                </option>
              <% end %>
            </select>
          </div>

          <div class="d-flex justify-content-between align-items-center mb-2">
            <div>
              <span class="badge bg-secondary" data-inventory-transfer-target="sourceCount">0</span> piezas disponibles
            </div>
          </div>

          <div class="border rounded" style="min-height: 300px; max-height: 500px; overflow-y: auto;">
            <div data-inventory-transfer-target="sourceItems" class="p-3 text-center text-muted">
              <i class="fas fa-arrow-up fa-2x mb-2"></i>
              <p>Selecciona una ubicación origen</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Panel Destino -->
    <div class="col-md-6">
      <div class="card h-100">
        <div class="card-header bg-success text-white">
          <i class="fas fa-sign-in-alt"></i> Ubicación Destino
        </div>
        <div class="card-body">
          <div class="mb-3">
            <label class="form-label fw-bold">Seleccionar ubicación:</label>
            <select class="form-select"
                    data-inventory-transfer-target="destSelect"
                    data-action="change->inventory-transfer#loadDestination">
              <option value="">-- Seleccionar ubicación destino --</option>
              <% @locations.each do |loc| %>
                <option value="<%= loc.id %>" data-url="<%= admin_inventory_location_items_path(location_id: loc.id) %>">
                  <%= loc.full_path %> (<%= loc.inventories.where(status: %i[available reserved]).count %> piezas)
                </option>
              <% end %>
            </select>
          </div>

          <div class="d-flex justify-content-between align-items-center mb-2">
            <div>
              <span class="badge bg-secondary" data-inventory-transfer-target="destCount">0</span> piezas
            </div>
            <button type="button" class="btn btn-sm btn-outline-secondary"
                    data-action="click->inventory-transfer#refreshDestination">
              <i class="fas fa-sync-alt"></i> Actualizar
            </button>
          </div>

          <div class="border rounded" style="min-height: 300px; max-height: 500px; overflow-y: auto;">
            <div data-inventory-transfer-target="destItems" class="p-3 text-center text-muted">
              <i class="fas fa-arrow-up fa-2x mb-2"></i>
              <p>Selecciona una ubicación destino</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Barra de acción -->
  <div class="card mt-3">
    <div class="card-body py-3">
      <div class="row align-items-center">
        <div class="col-md-6">
          <div class="d-flex align-items-center gap-3">
            <div>
              <span class="text-muted">Seleccionados:</span>
              <span class="badge bg-primary fs-5 ms-2" data-inventory-transfer-target="selectedCount">0</span>
            </div>
          </div>
        </div>
        <div class="col-md-6 text-end">
          <button type="button"
                  class="btn btn-lg btn-success"
                  data-inventory-transfer-target="transferBtn"
                  data-action="click->inventory-transfer#executeTransfer"
                  data-url="<%= admin_inventory_execute_transfer_path %>"
                  disabled>
            <i class="fas fa-arrow-right me-2"></i>
            Transferir al Destino
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Alertas -->
  <div data-inventory-transfer-target="alerts" class="mt-3"></div>
</div>
