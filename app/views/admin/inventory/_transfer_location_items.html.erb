<% if items.any? %>
  <table class="table table-sm table-hover mb-0">
    <thead class="table-light sticky-top">
      <tr>
        <th width="30">
          <input type="checkbox" class="form-check-input select-all-checkbox">
        </th>
        <th>Producto</th>
        <th width="80">Status</th>
        <th width="90">Costo</th>
      </tr>
    </thead>
    <tbody>
      <% items.group_by(&:product).each do |product, product_items| %>
        <% product_items.each_with_index do |item, idx| %>
          <tr class="item-row" data-item-id="<%= item.id %>">
            <td>
              <input type="checkbox"
                     class="form-check-input item-checkbox"
                     value="<%= item.id %>"
                     data-action="change->inventory-transfer#updateSelection">
            </td>
            <td>
              <% if idx == 0 %>
                <div class="d-flex align-items-center">
                  <% if product.product_images.attached? %>
                    <%= image_tag product.product_images.first.variant(resize_to_limit: [30, 30]), class: 'me-2 rounded' %>
                  <% end %>
                  <div>
                    <strong class="small"><%= product.product_name %></strong>
                    <br><small class="text-muted"><%= product.product_sku %></small>
                    <span class="badge bg-light text-dark ms-1">×<%= product_items.size %></span>
                  </div>
                </div>
              <% else %>
                <small class="text-muted ms-4">└ Pieza #<%= item.id %></small>
              <% end %>
            </td>
            <td>
              <span class="badge bg-<%= item.status == 'available' ? 'success' : 'info' %> small">
                <%= item.status %>
              </span>
            </td>
            <td class="small">
              <%= number_to_currency(item.purchase_cost, unit: '$', precision: 2) %>
            </td>
          </tr>
        <% end %>
      <% end %>
    </tbody>
  </table>
<% else %>
  <div class="p-4 text-center text-muted">
    <i class="fas fa-inbox fa-2x mb-2"></i>
    <p class="mb-0">No hay piezas disponibles en esta ubicación</p>
  </div>
<% end %>
