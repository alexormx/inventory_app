<!DOCTYPE html>
<html>
  <head>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type' />
    <style>
      body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
      .container { max-width: 600px; margin: 0 auto; padding: 20px; }
      .header { background-color: #007bff; color: white; padding: 20px; text-align: center; }
      .content { padding: 20px; background-color: #f9f9f9; }
      .order-summary { background-color: white; padding: 15px; margin: 20px 0; border-radius: 5px; }
      .item { border-bottom: 1px solid #eee; padding: 10px 0; }
      .item:last-child { border-bottom: none; }
      .total { font-weight: bold; font-size: 1.2em; text-align: right; padding-top: 15px; border-top: 2px solid #007bff; }
      .address { background-color: #fff; padding: 15px; margin: 15px 0; border-left: 4px solid #007bff; }
      .footer { text-align: center; padding: 20px; color: #777; font-size: 0.9em; }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>¡Gracias por tu pedido!</h1>
      </div>

      <div class="content">
        <p>Hola <%= @user.email %>,</p>
        <p>Tu pedido ha sido recibido y está siendo procesado.</p>

        <div class="order-summary">
          <h2>Pedido #<%= @sale_order.id %></h2>
          <p><strong>Fecha:</strong> <%= @sale_order.order_date.strftime('%d/%m/%Y') %></p>
          <p><strong>Estado:</strong> <%= @sale_order.status %></p>

          <h3>Artículos:</h3>
          <% @items.each do |item| %>
            <div class="item">
              <strong><%= item.product.product_name %></strong><br>
              SKU: <%= item.product.product_sku %><br>
              Cantidad: <%= item.quantity %> x <%= number_to_currency(item.unit_cost, unit: "$") %> = <%= number_to_currency(item.total_line_cost, unit: "$") %>
              <% if item.preorder_quantity > 0 %>
                <br><em>(Incluye <%= item.preorder_quantity %> en preventa)</em>
              <% end %>
              <% if item.backordered_quantity > 0 %>
                <br><em>(Incluye <%= item.backordered_quantity %> en backorder)</em>
              <% end %>
            </div>
          <% end %>

          <div style="margin-top: 20px;">
            <p><strong>Subtotal:</strong> <%= number_to_currency(@sale_order.subtotal, unit: "$") %></p>
            <% if @sale_order.shipping_cost > 0 %>
              <p><strong>Envío:</strong> <%= number_to_currency(@sale_order.shipping_cost, unit: "$") %></p>
            <% end %>
            <% if @sale_order.total_tax > 0 %>
              <p><strong>Impuestos:</strong> <%= number_to_currency(@sale_order.total_tax, unit: "$") %></p>
            <% end %>
            <% if @sale_order.discount && @sale_order.discount > 0 %>
              <p><strong>Descuento:</strong> -<%= number_to_currency(@sale_order.discount, unit: "$") %></p>
            <% end %>
            <div class="total">
              Total: <%= number_to_currency(@sale_order.total_order_value, unit: "$") %>
            </div>
          </div>
        </div>

        <% if @shipping_address %>
          <div class="address">
            <h3>Dirección de Envío:</h3>
            <p>
              <%= @shipping_address.full_name %><br>
              <%= @shipping_address.line1 %><br>
              <% if @shipping_address.line2.present? %>
                <%= @shipping_address.line2 %><br>
              <% end %>
              <%= @shipping_address.city %>, <%= @shipping_address.state %> <%= @shipping_address.postal_code %><br>
            </p>
          </div>
        <% end %>

        <% if @sale_order.notes.present? %>
          <div style="background-color: #fff3cd; padding: 15px; margin: 15px 0; border-radius: 5px;">
            <strong>Notas:</strong><br>
            <%= @sale_order.notes %>
          </div>
        <% end %>

        <p>Te notificaremos cuando tu pedido sea enviado.</p>
        <p>Si tienes alguna pregunta, no dudes en contactarnos.</p>
      </div>

      <div class="footer">
        <p>Pasatiempos - Tu tienda de confianza</p>
        <p>Este es un correo automático, por favor no respondas a este mensaje.</p>
      </div>
    </div>
  </body>
</html>
