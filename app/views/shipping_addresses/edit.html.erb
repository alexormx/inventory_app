<h1 class="mb-3">Editar dirección</h1>
<%= form_with model: @address, local: true do |f| %>
  <% if params[:return_to].present? %>
    <%= hidden_field_tag :return_to, params[:return_to] %>
  <% end %>
  <div class="row g-2">
    <div class="col-6">
      <%= f.label :label, 'Etiqueta' %>
      <%= f.text_field :label, class: 'form-control', placeholder: 'Casa / Oficina' %>
    </div>
    <div class="col-6">
      <%= f.label :full_name, 'Nombre' %>
      <%= f.text_field :full_name, class: 'form-control', required: true %>
    </div>
    <div class="col-12">
      <%= f.label :line1, 'Dirección (línea 1)' %>
      <%= f.text_field :line1, class: 'form-control', required: true %>
    </div>
    <div class="col-12">
      <%= f.label :line2, 'Dirección (línea 2)' %>
      <%= f.text_field :line2, class: 'form-control' %>
    </div>
    <div class="col-4">
      <%= f.label :postal_code, 'CP' %>
      <%= f.text_field :postal_code, class: 'form-control', required: true, id: 'cust_edit_addr_cp', maxlength: 5 %>
    </div>
    <div class="col-8">
      <%= f.label :settlement, 'Colonia' %>
      <select class="form-select" id="cust_edit_addr_colonia" name="shipping_address[settlement]" data-current="<%= @address.settlement %>"></select>
    </div>
    <div class="col-6">
      <%= f.label :municipality, 'Municipio' %>
      <%= f.text_field :municipality, class: 'form-control', id: 'cust_edit_addr_municipio', readonly: true %>
    </div>
    <div class="col-6">
      <%= f.label :state, 'Estado' %>
      <%= f.text_field :state, class: 'form-control', id: 'cust_edit_addr_estado', readonly: true %>
    </div>
    <div class="col-6">
      <%= f.label :city, 'Ciudad (manual)' %>
      <%= f.text_field :city, class: 'form-control', required: true %>
    </div>
    <div class="col-6">
      <%= f.label :country, 'País' %>
      <%= f.text_field :country, class: 'form-control', required: true %>
    </div>
    <div class="col-12 form-check mt-1">
      <%= f.check_box :default, class: 'form-check-input', id: 'addr_default' %>
      <%= f.label :default, 'Establecer como predeterminada', class: 'form-check-label' %>
    </div>
    <div class="col-12 d-flex justify-content-between mt-2">
      <%= link_to 'Cancelar', shipping_addresses_path, class: 'btn btn-outline-secondary' %>
      <%= f.submit 'Actualizar', class: 'btn btn-primary' %>
    </div>
  </div>
<% end %>

<script type="module">
  import { setupAddressAutofill } from '/assets/custom/address_autofill.js';
  document.addEventListener('turbo:load', () => {
    setupAddressAutofill({
      cpInput: '#cust_edit_addr_cp',
      coloniaSelect: '#cust_edit_addr_colonia',
      municipioInput: '#cust_edit_addr_municipio',
      estadoInput: '#cust_edit_addr_estado'
    });
  });
</script>
